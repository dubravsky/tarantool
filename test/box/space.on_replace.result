ts = box.schema.create_space('ttest_space')
---
...
ts:create_index('primary', 'hash')
---
...
type(ts.on_replace)
---
- function
...
ts.on_replace()
---
- error: 'usage: space:on_replace instead space.on_replace'
...
ts:on_replace()
---
- null
...
ts:on_replace(123)
---
- error: 'usage: space:on_replace([ function | nil ])'
...
type(ts:on_replace(function(old_tuple, new_tuple) error('test') end))
---
- function
...
type(ts:on_replace())
---
- function
...
ts:on_replace()()
---
- error: '[string "return type(ts:on_replace(function(old_tuple,..."]:1: test'
...
ts:insert(1, 'b', 'c')
---
- error: 'Lua error: [string "return type(ts:on_replace(function(old_tuple,..."]:1:
    test'
...
ts:select(0, 1)
---
...
ts:on_replace(nil)
---
- null
...
ts:insert(1, 'b', 'c')
---
- [1, 'b', 'c']
...
ts:select(0, 1)
---
- [1, 'b', 'c']
...
type(ts:on_replace(function(old_tuple, new_tuple) error('abc') end))
---
- function
...
ts:insert(2, 'b', 'c')
---
- error: 'Lua error: [string "return type(ts:on_replace(function(old_tuple,..."]:1:
    abc'
...
ts:select(0, 2)
---
...
type(ts:on_replace(function(told, tnew) o = told n = tnew end))
---
- function
...
ts:insert(2, 'a', 'b', 'c')
---
- [2, 'a', 'b', 'c']
...
o == nil
---
- true
...
n ~= nil
---
- true
...
n[1] == 'a'
---
- true
...
n[2] == 'b'
---
- true
...
n[3] == 'c'
---
- true
...
ts:replace(2, 'b', 'c', 'd')
---
- [2, 'b', 'c', 'd']
...
o ~= nil
---
- true
...
n ~= nil
---
- true
...
o[1] == 'a'
---
- true
...
n[1] == 'b'
---
- true
...
o[2] == 'b'
---
- true
...
n[2] == 'c'
---
- true
...
ts:drop()
---
...
